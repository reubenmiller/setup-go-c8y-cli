name: example
on:
  workflow_dispatch:

env:
  C8Y_HOST: '${{ secrets.C8Y_HOST }}'
  C8Y_USER: '${{ secrets.C8Y_USER }}'
  C8Y_PASSWORD: '${{ secrets.C8Y_PASSWORD }}'

jobs:
  job1:
      runs-on: ubuntu-latest
      timeout-minutes: 5
      steps:
        - uses: actions/checkout@v4
        - uses: reubenmiller/setup-go-c8y-cli@feat-stdin-redirect

        - name: Redirect stdin to /dev/null globally to prevent FIFO issues
          run: |
            exec 0</dev/null  # Redirect stdin globally

        - name: No stdin check
          run: |
            c8y devices list -n

        - name: Stdin check
          run: |
            c8y devices list

  job2:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@v4
      - uses: reubenmiller/setup-go-c8y-cli@main

      - name: No stdin check
        run: |
          c8y devices list -n
      - name: Stdin check
        run: |
          timeout 5 c8y devices list
