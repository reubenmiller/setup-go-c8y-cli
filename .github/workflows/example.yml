name: example
on:
  workflow_dispatch:

env:
  C8Y_HOST: '${{ secrets.C8Y_HOST }}'
  C8Y_USER: '${{ secrets.C8Y_USER }}'
  C8Y_PASSWORD: '${{ secrets.C8Y_PASSWORD }}'

jobs:
  job0:
      name: job0 (new c8y version)
      runs-on: ubuntu-latest
      timeout-minutes: 5
      steps:
        - uses: actions/checkout@v4

        - name: Set up Go 1.x
          uses: actions/setup-go@v5
          with:
            go-version: "1.24"

        - run: |
            go install github.com/reubenmiller/go-c8y-cli/v2/cmd/c8y@fix-improve-stdin-detection

        - name: No stdin check
          run: |
            c8y devices list -n

        - name: Stdin check
          run: |
            c8y devices list

  job1:
      name: job1 (redirect stdin)
      runs-on: ubuntu-latest
      timeout-minutes: 5
      steps:
        - uses: actions/checkout@v4
        - uses: reubenmiller/setup-go-c8y-cli@feat-stdin-redirect

        - name: No stdin check
          run: |
            c8y devices list -n

        - name: Stdin check
          run: |
            exec 0</dev/null  # Redirect stdin globally
            c8y devices list

  job2:
    name: job2 (current)
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@v4
      - uses: reubenmiller/setup-go-c8y-cli@main

      - name: No stdin check
        run: |
          c8y devices list -n
      - name: Stdin check
        run: |
          timeout 5 c8y devices list
